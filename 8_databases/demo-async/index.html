<!DOCTYPE html>
<html>
    <head>
        <title>YOUR TITLE GOES HERE</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <style type="text/css">
            /* Format the table to have black cell borders. */
            #display {
                border-collapse: collapse;
            }
            #display td, #display th {
                border: 1px solid black;
            }
        </style>
    </head>

    <body>
        <!-- Input form. -->
        <h1>Enter a new high score</h1>
        Name: <input type="text" id="tblName"><br>
        Game: <input type="text" id="tblGame"><br>
        Score: <input type="number" id="tblScore"><br><br>
        <button onclick="submit()">Submit</button>

        <!-- Report. -->
        <h1>High Scores</h1>
        <table id="display"></table>


        <!-- Include JQuery for AJAX calls. -->
        <script src="./jquery-3.3.1.min.js"></script>

        <script>
            /*
                Students:
                =========

                Most of this script can be left as-is, without changing.
                You will need to change these pieces:
                    1. Change the fields of `data` in the submit() function.
                    2. Change the entire refresh() function to create your report.
                        - If you want your report to be a table, just modify the line inside of `result.forEach()`.
                    3. Add any other JavaScript behaviour you want your page to have.
            */

            // Empty array (with global scope) to store the query results.
            var result = [];

            // Catch AJAX errors.
            $(document).ajaxError(function(event, jqXHR, ajaxSettings, thrownError) {
                console.log(jqXHR.responseText);
            });

            function submit() {
                /* STUDENTS:  Modify the `data` field below. */

                // Build the data to submit.
                var data = {
                    tblName: document.getElementById('tblName').value,
                    tblGame: document.getElementById('tblGame').value,
                    tblScore: document.getElementById('tblScore').value
                };

                // Submit via AJAX.
                $.ajax({
                    type: 'POST',
                    url: './insert-async.php',
                    data: data,
                    success: function(data, status, xhr) {
                        query();
                    }
                });
            }

            function query(data, status, xhr) {
                // Send the query via AJAX.
                $.ajax({
                    type: 'GET',
                    url: './query-async.php',
                    success: function(data, status, xhr) {
                        result = JSON.parse(data);
                        refresh();
                    }
                });
            }

            function refresh() {
                /* STUDENTS:  Modify this code to create your own report. */

                // Build a table to display the results.
                var out = '<tr><th>Name</th><th>Game</th><th>Score</th>';
                result.forEach(function(row) {
                    out += '<tr><td>' + row['tblName'] + '</td><td>' + row['tblGame'] + '</td><td>' + row['tblScore'] + '</td></tr>';
                });

                // Update the table on the page.
                document.getElementById('display').innerHTML = out;
            }

            // Query the database when the window first loads.
            window.onload = query;
        </script>
    </body>
</html>
